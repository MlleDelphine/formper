{% extends "::baseadmin.html.twig" %}

{% block title %}
    {{ parent() }} - Listing des différents niveaux
{% endblock %}

{% block stylesheets %}
    {{ parent() }}
    {% if form is defined %}
        <link rel="stylesheet" href="{{ asset('bundles/adminbundle/js/select2-4.0.0/css/select2.min.css') }}">
        {{ form_stylesheet(form) }}
    {% endif %}
{% endblock %}

{% block sidebarmenu %}
    {{ include('FormationAdminBundle::sidebar-menu.html.twig',{ 'pseudo': 'Delphine'}) }}
{% endblock %}

 {% block headersection %}
     {{ include('FormationAdminBundle::header.html.twig') }}
 {% endblock %}

{% block body -%}
    <h1>Section formation</h1>

    <div class="col-md-12">
        <div class="block">
            <div class="block-title">
                <div class="block-options pull-right">
                    <a href="{{ path('formation') }}" class="btn btn-alt btn-sm btn-default toggle-bordered enable-tooltip" data-toggle="button" title="Retourner à la liste">Retour</a>
                </div>
                <h2>Edition d'une formation</h2>
            </div>

            <form class="form-horizontal form-bordered" action="{{ path('formation_update', {'id':entity.id}) }}" method="post" {{ form_enctype(edit_form) }}>
                <div class="form-group">
                    {{ form_label(edit_form.name, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.name, { 'attr': {'class': 'form-control'} }) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_label(edit_form.shortDescription, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.shortDescription, { 'attr': {'class': 'form-control'} }) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_label(edit_form.longDescription, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.longDescription, { 'attr': {'class': ''} }) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_label(edit_form.price, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.price) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_label(edit_form.published, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.published, { 'attr': {'class': 'form-control'} }) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_label(edit_form.teacher, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.teacher, { 'attr': {'class': 'select-select2', 'style': 'width: 100%'} }) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_label(edit_form.level, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.level, { 'attr': {'class': 'select-select2', 'style': 'width: 100%' } }) }}
                    </div>
                </div>
                <div class="form-group">
                    {{ form_label(edit_form.technologies, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                    <div class="col-md-9">
                        {{ form_widget(edit_form.technologies, { 'attr': {'class': 'select-select2', 'style': 'width: 100%'} }) }}
                    </div>
                </div>
                {# Prérequis  #}
                <div class="form-group">
                    <label class="col-md-3 control-label">Prérequis</label>
                    <div class="col-md-9 requirements" data-prototype="{{ form_widget(edit_form.requirements.vars.prototype)|e }}">
                        {%  for requirement in edit_form.requirements %}
                            <div class="requirement-all-element">
                                <div class="col-md-5 requirement-element">
                                    {{ form_label(requirement.technology, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                                    <div class="col-md-9">
                                        {{ form_widget(requirement.technology, { 'attr': {'class': 'select-select2', 'style': 'width: 100%'} } ) }}
                                    </div>
                                </div>
                                <div class="col-md-5 requirement-element">
                                    {{ form_label(requirement.level, null, {'label_attr': {'class':'col-md-3 control-label'} }) }}
                                    <div class="col-md-9">
                                        {{ form_widget(requirement.level, { 'attr': {'class': 'select-select2', 'style': 'width: 100%'} }) }}
                                    </div>
                                </div>
                            </div>
                        {% endfor %}
                    </div>
                </div>
                <div class="form-group form-actions">
                    <div class="col-md-3 col-md-offset-3">
                        {{ form_widget(edit_form.submit) }}
                    </div>
                </div>
                {{ form_widget(edit_form._token) }}
            </form>
        </div>

        <div class="block">
            {{  form_start(delete_form, { 'attr': {'class': 'form-horizontal form-bordered'}}) }}
            <div class="form-group form-actions">
                <div class="col-md-1 col-md-offset-11">
                    {{ form_widget(delete_form.submit) }}
                </div>
            </div>
            {{ form_end(delete_form) }}
        </div>
    </div>
{% endblock %}
{% block scripts %}
    {{ parent() }}
    {% if edit_form is defined %}
        <script src="{{ asset('bundles/adminbundle/js/tinymce/tinymce.min.js') }}"></script>
        {{ form_javascript(edit_form) }}
        {# Prérequis dynamiqueement ajoutés #}
        <script>
            {# Ajout d'un prérequis dynamiquement #}

            // Récupère le div qui contient la collection de requirements
            var collectionHolder = $('div.requirements');

            // ajoute un lien « add a Requirement »
            var $addRequirementLink = $('<a href="#" class="add_requirement_link">Ajouter un prérequis</a>');
            var $newLinkLi = $('<div class="col-md-9"></div>').append($addRequirementLink);

            jQuery(document).ready(function() {
                // ajoute l'ancre « ajouter un Requirement » et li à la balise ul
                collectionHolder.append($newLinkLi);

                $addRequirementLink.on('click', function(e) {
                    // empêche le lien de créer un « # » dans l'URL
                    e.preventDefault();

                    // ajoute un nouveau formulaire Requirement (voir le prochain bloc de code)
                    addRequirementForm(collectionHolder, $newLinkLi);
                    addRequirementFormDeleteLink($newFormLi);
                });
            });

            function addRequirementForm(collectionHolder, $newLinkLi) {
                // Récupère l'élément ayant l'attribut data-prototype comme expliqué plus tôt
                var prototype = collectionHolder.attr('data-prototype');

                // Remplace '__name__' dans le HTML du prototype par un nombre basé sur
                // la longueur de la collection courante
                var newForm = prototype.replace(/__name__/g, collectionHolder.children().length);

                // Affiche le formulaire dans la page dans une div, avant le lien "ajouter un tag"
                var $newFormLi = $('<div></div>').append(newForm);
                $newLinkLi.before($newFormLi);
            }

            {# Suppression d'un prérequis dynamiquement #}

            jQuery(document).ready(function() {
                // ajoute un lien de suppression à tous les éléments li de
                // formulaires de tag existants
                collectionHolder.find('div.requirement-all-element').each(function() {
                    addRequirementFormDeleteLink($(this));
                });
            });

            function addRequirementFormDeleteLink($requirementFormLi) {
                var $removeFormA = $('<a href="#" class="btn btn-danger col-md-1"><i class="fa fa-trash-o"></i></a>');
                $requirementFormLi.append($removeFormA);

                $removeFormA.on('click', function(e) {
                    // empêche le lien de créer un « # » dans l'URL
                    e.preventDefault();

                    // supprime l'élément li pour le formulaire de tag
                    $requirementFormLi.remove();
                });
            }


        </script>
    {% endif %}
{% endblock %}
